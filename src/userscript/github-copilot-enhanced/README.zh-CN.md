[English](./README.md) | [中文](./README.zh-CN.md)

----

# Github Copilot Enhanced

一个用于增强 GitHub Copilot (Web) 的 UserScript。

> [!WARNING]  
> 请注意，此脚本并非官方产品，使用时请确保了解其工作原理及潜在风险。
> 
> 所有数据仅存储在本地浏览器中，不会上传到任何服务器。

![example-search](./docs/example-search.webp)

## 功能特性

### 🗄️ 长期存储
默认情况下，GitHub Copilot (Web) 仅保留 30 天内的聊天记录。
本脚本通过将聊天记录保存到浏览器的 IndexedDB 中，实现了更长时间的聊天记录保存功能。

## 🔍 搜索功能
- **快捷键打开**: 按下 `Ctrl/Cmd+K` 快速打开搜索面板
- **实时搜索**: 输入关键词时，实时显示匹配的聊天记录，支持模糊搜索
- **键盘导航**: 使用方向键浏览搜索结果，按 Enter 键打开对应聊天记录

### ⚙️ 设置面板
- **快捷访问**: 在搜索面板中点击齿轮图标打开设置
- **配置管理**: 统一管理脚本的各项配置选项
- **WebDAV 同步**: 配置 WebDAV 服务器实现跨浏览器/设备的数据同步

### 🔄 自动同步
- **定期同步**: 每 30 分钟自动同步一次所有聊天记录
- **首次加载**: 页面加载时立即执行一次同步
- **后台运行**: 同步过程在后台进行，不影响正常使用

### ☁️ WebDAV 同步
- **配置简单**: 在设置面板中输入 WebDAV 服务器地址、用户名和密码
- **手动同步**: 支持手动触发上传和下载操作
- **智能合并**: 下载时自动合并本地和远程数据，保留最新版本
- **跨设备**: 通过 WebDAV 实现多设备间的数据同步

### 🔌 无缝集成
- **请求拦截**: 自动拦截 GitHub Copilot 的 API 请求
- **数据合并**: 将本地历史记录与服务器数据合并后返回
- **透明操作**: 对用户完全透明，无需额外操作

## 使用方法

### 安装
1. 安装 Tampermonkey 或其他 UserScript 管理器
2. [点此安装](https://github.com/ZiuChen/userscript/raw/refs/heads/main/src/userscript/github-copilot-enhanced/index.user.js) 该脚本

### 配置 WebDAV 同步（可选）
1. 按下 `Ctrl/Cmd+K` 打开搜索面板
2. 点击右上角的齿轮图标打开设置面板
3. 在 "WebDAV 同步" 部分填写：
   - 服务器地址：如 `https://example.com/webdav`
   - 用户名和密码
4. 点击"保存配置"
5. 点击"测试连接"验证配置是否正确
6. 使用"上传数据"和"下载数据"按钮进行手动同步

**注意事项**：
- 首次上传前，如果远程已有文件，会自动先下载并合并
- 下载时会自动合并本地和远程数据，保留时间戳较新的版本
- 支持主流的 WebDAV 服务，如坚果云、Nextcloud 等

## 注意事项

1. **认证问题**: 项目使用浏览器已有的认证信息进行 API 请求，确保已登录 GitHub 并拥有访问 Copilot Pro 及以上的权限
2. **存储限制**: IndexedDB 受浏览器存储配额限制，过多数据可能导致存储失败
3. **隐私安全**: 
   - 所有数据仅存储在本地浏览器的 IndexedDB 中
   - WebDAV 同步功能完全可选，不配置则不会上传任何数据
   - WebDAV 账号密码使用 GM_setValue 加密存储在本地
4. **兼容性**: 需要支持 IndexedDB 的现代浏览器
5. **同步频率**: 默认 30 分钟同步一次 GitHub Copilot 数据，可根据需要调整
6. **WebDAV 安全**: 
   - 建议使用 HTTPS 协议的 WebDAV 服务器
   - 定期检查远程备份文件的完整性
   - 注意 WebDAV 服务器的存储空间限制
